<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>ChildrenMeal</title>
    <style>
        .wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 132px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
        .wrap * {padding: 0;margin: 0;}
        .wrap .info {width: 286px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
        .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
        .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 18px;font-weight: bold;}
        .info .close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');}
        .info .close:hover {cursor: pointer;}
        .info .body {position: relative;overflow: hidden;}
        .info .desc {position: relative;margin: 13px 0 0 90px;height: 75px;}
        .desc .ellipsis {overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
        .desc .jibun {font-size: 11px;color: #888;margin-top: -2px;}
        .info .img {position: absolute;top: 6px;left: 5px;width: 73px;height: 71px;border: 1px solid #ddd;color: #888;overflow: hidden;}
        .info:after {content: '';position: absolute;margin-left: -12px;left: 50%;bottom: 0;width: 22px;height: 12px;background: url('http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')}
        .info .link {color: #5085BB;}
    </style>
</head>
<body>
<div class="userInfo">
    <span th:text="${childDetailInfo.name}">이름</span>
    <span th:text="${childDetailInfo.age}">나이</span>
</div>
<div id="map" style="width:500px;height: 400px;"></div>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=657888584362b34de9ae34668675e958"></script>
<script th:inline="javascript">

    /*<![CDATA[*/
    var lat = [[ ${childDetailInfo.regionLat} ]];
    var lng = [[ ${childDetailInfo.regionLng} ]];
    /*]]>*/
    var mapContainer = document.getElementById('map');
    var mapOptions = {
        center : new kakao.maps.LatLng(lat,lng),//중앙 ( 본인 )
        level : 5
    };

    var imageSrc = "http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",//현재위치 이미 (별)
        imageSize = new kakao.maps.Size(24,35),
        imageOption = {offset : new kakao.maps.Point(27,35)};


    var markerImage = new kakao.maps.MarkerImage(imageSrc,imageSize,imageOption);
    var map = new kakao.maps.Map(mapContainer,mapOptions);

    var markerPosition =  new kakao.maps.LatLng(lat,lng);

    var marker = new kakao.maps.Marker({
        position:markerPosition,
        image:markerImage
    });

    marker.setMap(map);

    /*<![CDATA[*/
    var list = [[${restaurantData}]];
    /*]]>*/

    var places = [
        /*<![CDATA[*/
        {
            id:1,
            content :
                '<div class="wrap">' +
                '    <div class="info">' +
                '        <div class="title">'
                +
                list[0].resName
                +
                '        </div>' +
                '        <div class="body">' +
                '           </div>' +
                '            <div class="desc">' +
                '                <div class="ellipsis">' +
                list[0].resAddress +
                '               </div>' +
                '                <div>' +
                '                   <div><a href="https://map.kakao.com/link/map/'+list[0].resName+','+list[0].regionLat+','+list[0].regionLng+'" target="_blank" class="link">길찾</a></div>' +
                '            </div>' +
                '        </div>' +
                '    </div>' +
                '</div>',
            latlng : new kakao.maps.LatLng(list[0].regionLat,list[0].regionLng)
        },
        {
            id:2,
            content :
                '<div class="wrap">' +
                '    <div class="info">' +
                '        <div class="title">'
                +
                list[1].resName
                +
                '        </div>' +
                '        <div class="body">' +
                '           </div>' +
                '            <div class="desc">' +
                '                <div class="ellipsis">' +
                list[1].resAddress +
                '               </div>' +
                '                <div>' +
                '                   <div><a href="https://map.kakao.com/link/map/'+list[1].resName+','+list[1].regionLat+','+list[1].regionLng+'" target="_blank" class="link">길찾기</a></div>' +
                '            </div>' +
                '        </div>' +
                '    </div>' +
                '</div>',
            latlng : new kakao.maps.LatLng(list[1].regionLat,list[1].regionLng)
        },
        {
            id:3,
            content :
                '<div class="wrap">' +
                '    <div class="info">' +
                '        <div class="title">'
                +
                list[2].resName
                +
                '        </div>' +
                '        <div class="body">' +
                '           </div>' +
                '            <div class="desc">' +
                '                <div class="ellipsis">' +
                list[2].resAddress +
                '               </div>' +
                '                <div>' +
                '                   <div><a href="https://map.kakao.com/link/map/'+list[2].resName+','+list[2].regionLat+','+list[2].regionLng+'" target="_blank" class="link">길찾기</a></div>' +
                '            </div>' +
                '        </div>' +
                '    </div>' +
                '</div>',
            latlng : new kakao.maps.LatLng(list[2].regionLat,list[2].regionLng)
        },
        {
            id:4,
            content :
                '<div class="wrap">' +
                '    <div class="info">' +
                '        <div class="title">'
                +
                list[3].resName
                +
                '        </div>' +
                '        <div class="body">' +
                '           </div>' +
                '            <div class="desc">' +
                '                <div class="ellipsis">' +
                list[3].resAddress +
                '               </div>' +
                '                <div>' +
                '                   <div><a href="https://map.kakao.com/link/map/'+list[3].resName+','+list[3].regionLat+','+list[3].regionLng+'" target="_blank" class="link">길찾기</a></div>' +
                '            </div>' +
                '        </div>' +
                '    </div>' +
                '</div>',
            latlng : new kakao.maps.LatLng(list[3].regionLat,list[3].regionLng)
        }
    ];
    /*]]>*/
    /*<![CDATA[*/
    var activeId = null;
    var timeoutId = null;

    places.forEach(function (place) {
        var id = place.id;
        var position = place.latlng;
        var content = place.content;

        var resMarker = new kakao.maps.Marker({
            map: map,
            position: position
        });
        var overlay = new kakao.maps.CustomOverlay({
            yAnchor: 2.5,
            content: content,
            position: position
        });

        var mouseOverHandler = function() {
            if (timeoutId !== null && id === activeId) {
                window.clearTimeout(timeoutId);
                timeoutId = null;
                return;
            }
            overlay.setMap(map);
            activeId = id;
        };
        var mouseOutHandler = function() {
            timeoutId = window.setTimeout(function() {
                overlay.setMap(null);
                activeId = null;
                timeoutId = null;
            }, 1000);
        };

        kakao.maps.event.addListener(resMarker, 'mouseover', mouseOverHandler);
        kakao.maps.event.addListener(resMarker, 'mouseout', mouseOutHandler);
    });
    /*]]>*/
    //지도 움직임
    var mapTypeControl = new kakao.maps.MapTypeControl();
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
    var zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

</script>
<div id="resTable">
    <div class="panel-body" id="resInfo">
        <div class="table-responsive">
            <table id="licenseTable" class = "table table-striped">
                <thead class = "thread-dark">
                <tr>
                    <th>식당이름</th>
                    <th>주소</th>
                    <th>관련링크</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="c : ${restaurantData}">
                    <td th:text = "${c.resName}">식당이름</td>
                    <td th:text = "${c.resAddress}">주소</td>
                    <td th:text = "${c.resLink}" id="link"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>